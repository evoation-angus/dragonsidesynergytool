<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="DataTables-1.11.3/css/jquery.dataTables.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>


    <title>Document</title>
</head>

<body>
    <header>
        <div class="container">
            <div class="row border border-primary p-3 mb-2 bg-info text-white">
                <h1>Dragonside Synergy Tool</h1>
            </div>
        </div>
    </header>
    <div class="container mt-3">
        <div class="row">
            <div class="col border border-primary">
                <div class="row">
                    <div class="col">
                        <h3>ADC</h3>
                    </div>
                </div>
                <div class="row">
                    <div class="col mx-auto">
                        <div class="dropdown">
                            <button class="btn btn-info dropdown-toggle" type="button" id="dropdownMenuButton"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" name="recordinput">
                                Champion
                            </button>

                            <div id="champList" class="dropdown-menu" aria-labelledby="dropdownMenuButton">

                            </div>
                        </div>
                    </div>

                </div>
                <h2 id="adc"></h2>
                <img id="adcIcon" src="">
            </div>
            <div class="col-7 border border-primary">
                <div class="row row-cols-3">
                    <div class="col"></div>
                    <div class="col">
                        <h3>Support</h3>
                    </div>
                    <div class="col"></div>
                </div>
                <table class="table" id="supportTable">
                    <thead>
                        <tr>
                            <th scope="col">Name</th>
                            <th scope="col">Games</th>
                            <th scope="col">Win Rate</th>
                        </tr>
                    </thead>
                    <tbody id="supports">

                    </tbody>
                </table>
                <div class="row row-cols-3">
                    <div class="col"></div>
                    <div class="col">

                    </div>
                    <div class="col"></div>
                </div>
            </div>
        </div>


        <script>
            document.onload = getADCnames();
            var championIDtable = [];
            var table
            var counter = 0;


            function setTable() {
                if (counter >= 1) {
                    table.destroy();
                }

                table = $('#supportTable').DataTable({
                    ajax: {
                        type: "GET",
                        url: "https://dragonsidesynergy-env.eba-rfrgjick.ap-southeast-2.elasticbeanstalk.com/currentadc",
                        dataSrc: "supports",
                    },
                    columns: [
                        { "data": "name" },
                        {
                            "data": "occurences"

                        },
                        {
                            data: null,
                            render: function (data, type, row) {
                                return Math.round((row.wins / row.occurences) * 100) + "%";
                            }
                        }
                    ],
                    order: [[1, "desc"]],
                    "rowCallback": function (row, data, index) {
                        if (data[1] === null) {
                            $(row).remove();
                        }
                    }

                });

                counter++;
                filterRows();
            };
            function filterRows() {
                var indexes = table
                    .rows()
                    .indexes()
                    .filter(function (value, index) {
                        return 'Leona' === table.row(value).data()[0];
                    });

                table.rows(indexes).remove().draw();
            }


            function championSelect(element) {
                var name = element.innerHTML;
                var iconurl = "https://ddragon.leagueoflegends.com/cdn/11.22.1/img/champion/" + name + ".png";
                document.getElementById("adc").innerHTML = name;
                document.getElementById("adcIcon").src = iconurl;
                console.log(name);
                var id = element.id;

                sendADCID(id);
                //document.getElementById("supports").innerHTML = championIDtable[id];
            }

            function sendADCID(id) {
                var info = { ChampID: id };
                $.ajax({
                    type: "POST",
                    url: "https://dragonsidesynergy-env.eba-rfrgjick.ap-southeast-2.elasticbeanstalk.com/adcid",
                    data: JSON.stringify(info),
                    contentType: "application/json;",
                    success: function (data) {
                        console.log("Finished sending ID")
                        setTable()
                    }
                })
                console.log("Starting to get ADC")

            }

            function getADC() {
                $.ajax({

                    type: "GET",
                    url: "https://dragonsidesynergy-env.eba-rfrgjick.ap-southeast-2.elasticbeanstalk.com/currentadc",
                    success: function (data) {
                        var response = JSON.parse(data);
                        var supports = response.supports;
                        var json = '{"data" : ';
                        json += JSON.stringify(supports) + "}";
                        console.log(json);


                        /*console.log("Finished to get ADC")
                        var response = JSON.parse(data);
                        console.log(data);
                        var supports = response.supports;
                        console.log(supports);
                        var output = "";
                        for (var i = 0; i < supports.length; i++) {
                            let winRate = Math.round((supports[i].wins / supports[i].occurences) * 100);
                            output += '<tr>' + "<td>" + supports[i].name + '</td> <td>' + supports[i].occurences + "</td> <td> " + winRate + "%" + '</td> </tr>';
                        }
                        document.getElementById("supports").innerHTML = output;
                        tableSetup() */
                    }
                })
            }

            function getADCnames() {
                $.ajax({
                    type: "GET",
                    url: "https://dragonsidesynergy-env.eba-rfrgjick.ap-southeast-2.elasticbeanstalk.com/adcnames",
                    success: function (data) {
                        var response = JSON.parse(data);
                        var adcs = response;
                        var output = "";
                        for (var i = 0; i < adcs.length; i += 2) {
                            var name = adcs[i];
                            var champID = adcs[i + 1];
                            output += '<a class="dropdown-item"' + 'id="' + champID + '" ' + 'onclick="championSelect(this)"' + '>' + name + '</a>';
                        }
                        document.getElementById("champList").innerHTML = output;
                    }
                })

            }


        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns"
            crossorigin="anonymous"></script>
        <script type="text/javascript" src="DataTables-1.11.3/js/jquery.dataTables.js"></script>
</body>
